<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.1 Visualising spatial data | Statistical Modelling</title>
  <meta name="description" content="A conceptual, visual and practical introduction to statistical modelling" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="2.1 Visualising spatial data | Statistical Modelling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A conceptual, visual and practical introduction to statistical modelling" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.1 Visualising spatial data | Statistical Modelling" />
  
  <meta name="twitter:description" content="A conceptual, visual and practical introduction to statistical modelling" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="models-for-space.html"/>
<link rel="next" href="models-for-point-pattern-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.1/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A visual and conceptual introduction to statistical modelling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface: whatâ€™s the problem?</a></li>
<li class="chapter" data-level="1" data-path="other-approaches-to-inference.html"><a href="other-approaches-to-inference.html"><i class="fa fa-check"></i><b>1</b> Other approaches to inference</a>
<ul>
<li class="chapter" data-level="1.1" data-path="computational-inference.html"><a href="computational-inference.html"><i class="fa fa-check"></i><b>1.1</b> Computational inference</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="computational-inference.html"><a href="computational-inference.html#simulation-methods"><i class="fa fa-check"></i><b>1.1.1</b> Simulation methods</a></li>
<li class="chapter" data-level="1.1.2" data-path="computational-inference.html"><a href="computational-inference.html#randomisation-tests"><i class="fa fa-check"></i><b>1.1.2</b> Randomisation tests</a></li>
<li class="chapter" data-level="1.1.3" data-path="computational-inference.html"><a href="computational-inference.html#the-bootstrap"><i class="fa fa-check"></i><b>1.1.3</b> The bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="bayesian-inference.html"><a href="bayesian-inference.html"><i class="fa fa-check"></i><b>1.2</b> Bayesian inference</a></li>
<li class="chapter" data-level="1.3" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>1.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="exercises.html"><a href="exercises.html#coverage-property-of-bootstrap-confidence-intervals"><i class="fa fa-check"></i><b>1.3.1</b> Coverage property of bootstrap confidence intervals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="models-for-space.html"><a href="models-for-space.html"><i class="fa fa-check"></i><b>2</b> Models for space</a>
<ul>
<li class="chapter" data-level="2.1" data-path="visualising-spatial-data.html"><a href="visualising-spatial-data.html"><i class="fa fa-check"></i><b>2.1</b> Visualising spatial data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="visualising-spatial-data.html"><a href="visualising-spatial-data.html#the-maps-package"><i class="fa fa-check"></i><b>2.1.1</b> The <code>maps</code> package</a></li>
<li class="chapter" data-level="2.1.2" data-path="visualising-spatial-data.html"><a href="visualising-spatial-data.html#leaflet-and-mapview-interactive-maps"><i class="fa fa-check"></i><b>2.1.2</b> <code>leaflet</code> and <code>mapview</code>: interactive maps</a></li>
<li class="chapter" data-level="2.1.3" data-path="visualising-spatial-data.html"><a href="visualising-spatial-data.html#ggplot-and-ggmap"><i class="fa fa-check"></i><b>2.1.3</b> <code>ggplot</code> and <code>ggmap</code></a></li>
<li class="chapter" data-level="2.1.4" data-path="visualising-spatial-data.html"><a href="visualising-spatial-data.html#tmap"><i class="fa fa-check"></i><b>2.1.4</b> <code>tmap</code></a></li>
<li class="chapter" data-level="2.1.5" data-path="visualising-spatial-data.html"><a href="visualising-spatial-data.html#spatstat-for-spatial-point-patterns"><i class="fa fa-check"></i><b>2.1.5</b> <code>spatstat</code> for spatial point patterns</a></li>
<li class="chapter" data-level="2.1.6" data-path="visualising-spatial-data.html"><a href="visualising-spatial-data.html#areal-data"><i class="fa fa-check"></i><b>2.1.6</b> Areal data</a></li>
<li class="chapter" data-level="2.1.7" data-path="visualising-spatial-data.html"><a href="visualising-spatial-data.html#image-data"><i class="fa fa-check"></i><b>2.1.7</b> Image data</a></li>
<li class="chapter" data-level="2.1.8" data-path="visualising-spatial-data.html"><a href="visualising-spatial-data.html#spatiotemporal-animation"><i class="fa fa-check"></i><b>2.1.8</b> Spatiotemporal animation</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="models-for-point-pattern-data.html"><a href="models-for-point-pattern-data.html"><i class="fa fa-check"></i><b>2.2</b> Models for point pattern data</a></li>
<li class="chapter" data-level="2.3" data-path="geostatistical-models.html"><a href="geostatistical-models.html"><i class="fa fa-check"></i><b>2.3</b> Geostatistical models</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="geostatistical-models.html"><a href="geostatistical-models.html#gaussian-processes"><i class="fa fa-check"></i><b>2.3.1</b> Gaussian processes</a></li>
<li class="chapter" data-level="2.3.2" data-path="geostatistical-models.html"><a href="geostatistical-models.html#geostatistical-models-1"><i class="fa fa-check"></i><b>2.3.2</b> Geostatistical models</a></li>
<li class="chapter" data-level="2.3.3" data-path="geostatistical-models.html"><a href="geostatistical-models.html#so2-a-model-based-on-smoothing"><i class="fa fa-check"></i><b>2.3.3</b> SO2: a model based on smoothing</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="models-for-areal-data.html"><a href="models-for-areal-data.html"><i class="fa fa-check"></i><b>2.4</b> Models for areal data</a></li>
<li class="chapter" data-level="2.5" data-path="further-reading.html"><a href="further-reading.html"><i class="fa fa-check"></i><b>2.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="visualising-spatial-data" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Visualising spatial data<a href="visualising-spatial-data.html#visualising-spatial-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are many powerful tools for plotting spatial data and some of these are mentioned in this section. Many of these are also able to handle some of the special considerations neded for spatial data. The <em>co-ordinate reference system</em> (CRS) is one of those. Latitude and longitude are standard co-ordinates but data can often be spatially indexed in other ways, for example through Easting and Northing in a local reference system. Another issue is the use of <em>shapefiles</em> which contain the boundaries of regions of interest and other information. The <code>sf</code> package provides support for the <em>simple features</em> standard for representing spatial information.</p>
<div id="the-maps-package" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> The <code>maps</code> package<a href="visualising-spatial-data.html#the-maps-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This package provides some basic tools for drawing countries and regions on standard plots. In the chapter on flexible models, data on SO<span class="math inline">\(_2\)</span> across Europe was used as an example. The code below uses the <code>map</code> function to plot the locations of othe active monitoring stations in January 1990. Notice the use of :: because the function <code>map</code> is present in both the <code>maps</code> package and the <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="visualising-spatial-data.html#cb9-1" tabindex="-1"></a><span class="fu">library</span>(rpanel)</span>
<span id="cb9-2"><a href="visualising-spatial-data.html#cb9-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb9-3"><a href="visualising-spatial-data.html#cb9-3" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb9-4"><a href="visualising-spatial-data.html#cb9-4" tabindex="-1"></a>SO2_1990 <span class="ot">&lt;-</span> SO2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1990</span> <span class="sc">&amp;</span> month <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb9-5"><a href="visualising-spatial-data.html#cb9-5" tabindex="-1"></a><span class="fu">with</span>(SO2, {</span>
<span id="cb9-6"><a href="visualising-spatial-data.html#cb9-6" tabindex="-1"></a>  maps<span class="sc">::</span><span class="fu">map</span>(<span class="at">xlim =</span> <span class="fu">range</span>(longitude), <span class="at">ylim =</span> <span class="fu">range</span>(latitude))</span>
<span id="cb9-7"><a href="visualising-spatial-data.html#cb9-7" tabindex="-1"></a>  <span class="fu">points</span>(longitude, latitude, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb9-8"><a href="visualising-spatial-data.html#cb9-8" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="book_files/figure-html/SO2_read-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="leaflet-and-mapview-interactive-maps" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> <code>leaflet</code> and <code>mapview</code>: interactive maps<a href="visualising-spatial-data.html#leaflet-and-mapview-interactive-maps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One of the very good features of <code>R</code> is that it can connect to many other computing systems, making these environments available without leaving <code>R</code>. One example is the <a href="https://leafletjs.com">leaflet</a> Javascript library which provides many useful tools for the creation of interactive maps. Here is a simple example. When the code is executed in <code>R</code> it creates a map which can be scrolled and zoomed.</p>
<p>The <code>addTiles</code> function uses Open Street Map by default. Note the use of the <code>~</code> symbol in front of variable names. The <code>popup</code> argument allows us to</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="visualising-spatial-data.html#cb10-1" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb10-2"><a href="visualising-spatial-data.html#cb10-2" tabindex="-1"></a><span class="fu">leaflet</span>(SO2_1990) <span class="sc">%&gt;%</span> <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span> <span class="fu">addCircles</span>(<span class="sc">~</span>longitude, <span class="sc">~</span>latitude, </span>
<span id="cb10-3"><a href="visualising-spatial-data.html#cb10-3" tabindex="-1"></a>                  <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">popup =</span> <span class="sc">~</span>site)</span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-9ae098947b1df8f60385" style="width:70%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-9ae098947b1df8f60385">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addCircles","args":[[47.76666666666667,43.76666666666667,49.87777777777778,52.33333333333334,46.55,46.81666666666667,49.73333333333333,49.58333333333334,54.92555555555555,52.80222222222222,47.91472222222222,49.76472222222223,48.81944444444444,54.68333333333333,53.16666666666666,52.85,51.11666666666667,50.33333333333334,49.3,48.48333333333333,48.01666666666667,50.31666666666667,56.35,54.73333333333333,61.4,59.5,39.54777777777777,37.2,40.82055555555556,42.45777777777778,62.53333333333333,59.77916666666667,60.52666666666666,66.32027777777778,45.83333333333334,48.5,47.26666666666667,46.81666666666667,43.03333333333333,55.31305555555556,52.56666666666667,54.44305555555555,50.86666666666667,50.59638888888889,54.33444444444444,57.73444444444444,56.96666666666667,38.36666666666667,46.96666666666667,51.93972222222222,45.8,46.51666666666667,56.21666666666667,46.5,41.32,52.81666666666667,52.11666666666667,53.33388888888889,51.54111111111111,58.38333333333333,58.81666666666667,65.83333333333333,69.40000000000001,62.78333333333333,61.25,54.13333333333333,51.81666666666667,41.81666666666667,38.08333333333334,68.93333333333334,57.41666666666666,63.85,56.91666666666666,56.01666666666667,58.8,67.88333333333334,48.93333333333333,50.25,43.4],[16.76666666666667,18.03333333333333,5.203611111111111,23.43333333333333,7.983055555555556,6.95,16.03333333333333,15.08333333333333,8.309722222222222,10.75944444444444,7.908611111111111,7.051944444444445,13.21916666666667,13.43333333333333,13.03333333333333,8.699999999999999,7.633333333333333,8.533333333333333,10.56666666666667,8.933333333333334,11.35,11.88333333333333,9.6,10.73333333333333,-6.666666666666667,25.9,-4.348611111111111,-3.6,0.4913888888888889,-2.503055555555556,24.22166666666667,21.37722222222222,27.68611111111111,29.40166666666667,1.266666666666667,7.133333333333334,4.083333333333333,6.183333333333334,-1.083333333333333,-3.204166666666667,0.5,-7.87,-0.03305555555555555,-3.713055555555556,-0.8075,-4.774444444444445,-2.416666666666667,23.08333333333333,19.58333333333333,-10.24444444444444,8.633333333333333,11.88333333333333,21.21666666666667,28.26666666666667,20.42,6.666666666666667,5.2,6.277222222222222,5.853611111111111,8.25,6.716666666666667,13.91666666666667,24.6,8.883333333333333,11.78333333333333,22.95,21.98333333333333,-6.766666666666667,-8.800000000000001,28.85,11.93333333333333,15.33333333333333,18.15,13.15,17.38333333333333,21.06666666666667,19.58333333333333,23.63333333333333,21.95],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":true,"fillColor":"red","fillOpacity":0.2},["AT02","BA06","BE01","BY04","CH01","CH02","CZ01","CZ03","DE01","DE02","DE03","DE04","DE05","DE06","DE07","DE12","DE14","DE15","DE17","DE18","DE19","DE20","DK03","DK05","DK07","EE09","ES01","ES02","ES03","ES04","FI04","FI09","FI17","FI22","FR03","FR08","FR10","FR11","FR12","GB02","GB04","GB06","GB07","GB13","GB14","GB15","GB16","GR01","HU02","IE01","IT04","IT05","LV10","MD12","MK07","NL02","NL08","NL09","NL10","NO01","NO08","NO15","NO30","NO39","NO41","PL01","PL02","PT01","PT04","RU01","SE02","SE05","SE08","SE11","SE12","SE13","SK02","UA06","YU05"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]}],"limits":{"lat":[37.2,69.40000000000001],"lng":[-10.24444444444444,29.40166666666667]}},"evals":[],"jsHooks":[]}</script>
<p>The <code>mapview</code> package offers another means of creating interactive maps and it can use <code>leaflet</code> as its â€˜engineâ€™.</p>
</div>
<div id="ggplot-and-ggmap" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> <code>ggplot</code> and <code>ggmap</code><a href="visualising-spatial-data.html#ggplot-and-ggmap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- ```{r child = 'chapters/spatial/qmap_SO2.Rmd'} -->
<!-- ``` -->
<p>The <code>ggplot2</code> visualisation system, part of the <code>tidyverse</code> can handle â€˜sfâ€™ information through a <code>geom_sf</code> geometry. An example of this is given in the section on areal data below.</p>
</div>
<div id="tmap" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> <code>tmap</code><a href="visualising-spatial-data.html#tmap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is a popular package which fits well with the <code>tidyverse</code> format of coding, but it will not be covered here.</p>
</div>
<div id="spatstat-for-spatial-point-patterns" class="section level3 hasAnchor" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> <code>spatstat</code> for spatial point patterns<a href="visualising-spatial-data.html#spatstat-for-spatial-point-patterns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This package has a variety of useful tools for plotting spatial point patterns.</p>
</div>
<div id="areal-data" class="section level3 hasAnchor" number="2.1.6">
<h3><span class="header-section-number">2.1.6</span> Areal data<a href="visualising-spatial-data.html#areal-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There is a often a wish to investigate regional differences in a map, using well defined boundaries to define the regions of interest. This is a good way to visualise the Scottish Referendum data. A <em>shape file</em>, which provides the co-ordinates of the boundary of each region, has been downloaded from the <em>ONS Open Geography Portal</em>. This has been read into â€˜Râ€™ as an object, using the â€˜sfâ€™ package, and then <code>save</code>d to the file <code>UKLA.Rda</code>. <code>load</code>ing this file placess the object <code>councils</code> into the workspace.</p>
<p>The <code>councils</code> object contains details of all the local authorities in the UK so the <code>filter</code> function from the <code>dplyr</code> package is used to select out those identifiers which begin with â€˜Sâ€™ for Scotland.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="visualising-spatial-data.html#cb11-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-2"><a href="visualising-spatial-data.html#cb11-2" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb11-3"><a href="visualising-spatial-data.html#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="visualising-spatial-data.html#cb11-4" tabindex="-1"></a>path     <span class="ot">&lt;-</span> <span class="fu">rp.datalink</span>(<span class="st">&quot;scottish_referendum&quot;</span>)</span>
<span id="cb11-5"><a href="visualising-spatial-data.html#cb11-5" tabindex="-1"></a>ref      <span class="ot">&lt;-</span> <span class="fu">read.table</span>(path, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a href="visualising-spatial-data.html#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="visualising-spatial-data.html#cb11-7" tabindex="-1"></a><span class="co"># path     &lt;- &quot;~/iCloud/teaching/book/data_more/UKLA.Rda&quot;</span></span>
<span id="cb11-8"><a href="visualising-spatial-data.html#cb11-8" tabindex="-1"></a><span class="co"># load(path)</span></span>
<span id="cb11-9"><a href="visualising-spatial-data.html#cb11-9" tabindex="-1"></a>path     <span class="ot">&lt;-</span> <span class="st">&quot;~/iCloud/teaching/book/data_more/Local_Authority_Districts_December_2023_Boundaries_UK_BUC_-1729940581044841319/LAD_DEC_2023_UK_BUC.shp&quot;</span></span>
<span id="cb11-10"><a href="visualising-spatial-data.html#cb11-10" tabindex="-1"></a><span class="co"># dest &lt;- tempfile()</span></span>
<span id="cb11-11"><a href="visualising-spatial-data.html#cb11-11" tabindex="-1"></a><span class="co"># download.file(path, dest)</span></span>
<span id="cb11-12"><a href="visualising-spatial-data.html#cb11-12" tabindex="-1"></a><span class="co"># dest1 &lt;- tempfile()</span></span>
<span id="cb11-13"><a href="visualising-spatial-data.html#cb11-13" tabindex="-1"></a><span class="co"># unzip(dest, exdir = dest1)</span></span>
<span id="cb11-14"><a href="visualising-spatial-data.html#cb11-14" tabindex="-1"></a><span class="co"># councils &lt;- read_sf(dest1)</span></span>
<span id="cb11-15"><a href="visualising-spatial-data.html#cb11-15" tabindex="-1"></a>councils <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(path)</span>
<span id="cb11-16"><a href="visualising-spatial-data.html#cb11-16" tabindex="-1"></a>councils <span class="ot">&lt;-</span> councils[<span class="fu">substr</span>(councils<span class="sc">$</span>LAD23CD, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">==</span> <span class="st">&quot;S&quot;</span>, ]</span></code></pre></div>
<p>We then need to merge these two dataframes, <code>councils</code> and <code>ref</code>. The Council name is the obvious way to link the two but we need to check that the same names have been used. The code below checks whether each name in <code>ref</code> can be found in <code>councils.  This throws up some exceptions, so the</code>mutate<code>function from</code>dplyr<code>is used to recode these names in</code>councils<code>to match.  The</code>left_join<code>function from</code>dplyr<code>can then be used to merge the</code>ref<code>dataframe into</code>councils`.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="visualising-spatial-data.html#cb12-1" tabindex="-1"></a>ind <span class="ot">&lt;-</span> ref<span class="sc">$</span>Scottish.Council <span class="sc">%in%</span> councils<span class="sc">$</span>LAD23NM</span>
<span id="cb12-2"><a href="visualising-spatial-data.html#cb12-2" tabindex="-1"></a>ref<span class="sc">$</span>Scottish.Council[<span class="sc">!</span>ind]</span></code></pre></div>
<pre><code>## [1] &quot;Aberdeen&quot;    &quot;Dundee&quot;      &quot;Edinburgh&quot;   &quot;Eilean Siar&quot; &quot;Glasgow&quot;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="visualising-spatial-data.html#cb14-1" tabindex="-1"></a>councils <span class="ot">&lt;-</span> <span class="fu">mutate</span>(councils,</span>
<span id="cb14-2"><a href="visualising-spatial-data.html#cb14-2" tabindex="-1"></a>                   <span class="at">Scottish.Council =</span> <span class="fu">recode</span>(LAD23NM,</span>
<span id="cb14-3"><a href="visualising-spatial-data.html#cb14-3" tabindex="-1"></a>                            <span class="st">`</span><span class="at">Na h-Eileanan Siar</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Eilean Siar&quot;</span>,</span>
<span id="cb14-4"><a href="visualising-spatial-data.html#cb14-4" tabindex="-1"></a>                            <span class="st">`</span><span class="at">Aberdeen City</span><span class="st">`</span>      <span class="ot">=</span> <span class="st">&quot;Aberdeen&quot;</span>,</span>
<span id="cb14-5"><a href="visualising-spatial-data.html#cb14-5" tabindex="-1"></a>                            <span class="st">`</span><span class="at">Glasgow City</span><span class="st">`</span>       <span class="ot">=</span> <span class="st">&quot;Glasgow&quot;</span>,</span>
<span id="cb14-6"><a href="visualising-spatial-data.html#cb14-6" tabindex="-1"></a>                            <span class="st">`</span><span class="at">Dundee City</span><span class="st">`</span>        <span class="ot">=</span> <span class="st">&quot;Dundee&quot;</span>,</span>
<span id="cb14-7"><a href="visualising-spatial-data.html#cb14-7" tabindex="-1"></a>                            <span class="st">`</span><span class="at">City of Edinburgh</span><span class="st">`</span>  <span class="ot">=</span> <span class="st">&quot;Edinburgh&quot;</span>))</span>
<span id="cb14-8"><a href="visualising-spatial-data.html#cb14-8" tabindex="-1"></a>councils <span class="ot">&lt;-</span> <span class="fu">left_join</span>(councils, ref, <span class="at">by =</span> <span class="st">&quot;Scottish.Council&quot;</span>)</span></code></pre></div>
<p>Now we can plot the council regions as a map, using the <code>geom_sf</code> function in <code>ggplot2</code> to handle all the drawing for us, and using a variable of interest to define the fill colour. Here we plot the proportion in each region voting â€˜noâ€™, plus a rescaling to show which regions have a majority for â€˜yesâ€™ or noâ€™, and the level of turnout.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="visualising-spatial-data.html#cb15-1" tabindex="-1"></a><span class="fu">ggplot</span>(councils, <span class="fu">aes</span>(<span class="at">fill =</span> Voted.no)) <span class="sc">+</span> <span class="fu">geom_sf</span>()</span></code></pre></div>
<p><img src="book_files/figure-html/referendum_data_merged_plot_again-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="image-data" class="section level3 hasAnchor" number="2.1.7">
<h3><span class="header-section-number">2.1.7</span> Image data<a href="visualising-spatial-data.html#image-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Not all datasets can be structured easily into simple row and column format. Even for those which can, the dataset may be so large that more efficient and compact forms of storage are required. For example, the <code>netCDF</code> (network Common Data Form) is commonly used to store data which has an array structure, often corresponding to dense spatial and temporal measurements, but involving multiple variables. These datasets may be large in size. Satellite data is one example. The <code>netCDF</code> standard is widely used to achieve efficient storage. The <code>ncdf4</code> package in R provides tools for reading, handling and plotting this form of data.</p>
<p>An <a href="https://theconversation.com/an-extreme-heatwave-has-hit-the-seas-around-the-uk-and-ireland-heres-whats-going-on-208052?utm_medium=email&amp;utm_campaign=Latest%20from%20The%20Conversation%20for%20June%2021%202023%20-%202658726822&amp;utm_content=Latest%20from%20The%20Conversation%20for%20June%2021%202023%20-%202658726822+CID_d5ca938fc0c6a44b82fe010eac547815&amp;utm_source=campaign_monitor_uk&amp;utm_term=An%20extreme%20heatwave%20has%20hit%20the%20seas%20around%20the%20UK%20and%20Ireland%20%20heres%20whats%20going%20on">article</a> on a heatwave in the sea around the UK in 2023 used satellite data from the National Oceanic and Atmospheric Administration (NOAA) in the USA. Sea surface temperature is one of the key climate change indicators.</p>
<p>The data for June 18, 2023 can be read from the NOAA repository using the file download mechanism discussed above. The <code>ncdf4</code> package can then be used to extract the data we need. Use of the functions within the package require careful study of the help files and other documentation. The code below illustrates what can be done.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="visualising-spatial-data.html#cb16-1" tabindex="-1"></a><span class="fu">library</span>(rpanel)</span>
<span id="cb16-2"><a href="visualising-spatial-data.html#cb16-2" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb16-3"><a href="visualising-spatial-data.html#cb16-3" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">rp.datalink</span>(<span class="st">&quot;sea_surface_temperature&quot;</span>)</span>
<span id="cb16-4"><a href="visualising-spatial-data.html#cb16-4" tabindex="-1"></a>nc_data   <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(path)</span>
<span id="cb16-5"><a href="visualising-spatial-data.html#cb16-5" tabindex="-1"></a><span class="co"># print(nc_data)</span></span>
<span id="cb16-6"><a href="visualising-spatial-data.html#cb16-6" tabindex="-1"></a>lon       <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_data, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb16-7"><a href="visualising-spatial-data.html#cb16-7" tabindex="-1"></a>lat       <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_data, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-8"><a href="visualising-spatial-data.html#cb16-8" tabindex="-1"></a>anom      <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_data, <span class="st">&quot;anom&quot;</span>)</span>
<span id="cb16-9"><a href="visualising-spatial-data.html#cb16-9" tabindex="-1"></a>fillvalue <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(nc_data, <span class="st">&quot;anom&quot;</span>, <span class="st">&quot;_FillValue&quot;</span>)</span>
<span id="cb16-10"><a href="visualising-spatial-data.html#cb16-10" tabindex="-1"></a>anom[anom <span class="sc">==</span> fillvalue<span class="sc">$</span>value] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb16-11"><a href="visualising-spatial-data.html#cb16-11" tabindex="-1"></a><span class="fu">nc_close</span>(nc_data)</span></code></pre></div>
<p>This opens the datafile and extracts the latitude and longitude information as vectors which index the rows and columns of the matrix of anomaly (deviations from a long term average) measurements. The <code>print(nc_data)</code> instruction displays a lot of information on the content and source of the dataset but has been commented out above to save space. Missing data are also given the usual R representation.</p>
<p>To plot the data efficiently, the <code>raster</code> package is first used to put the data in <em>raster</em> format.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="visualising-spatial-data.html#cb17-1" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb17-2"><a href="visualising-spatial-data.html#cb17-2" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(anom), <span class="at">xmn =</span> <span class="fu">min</span>(lon), <span class="at">xmx =</span> <span class="fu">max</span>(lon), <span class="at">ymn =</span> <span class="fu">min</span>(lat), <span class="at">ymx =</span> <span class="fu">max</span>(lat), <span class="at">crs =</span> <span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb17-3"><a href="visualising-spatial-data.html#cb17-3" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">flip</span>(r, <span class="at">direction =</span> <span class="st">&#39;y&#39;</span>)</span>
<span id="cb17-4"><a href="visualising-spatial-data.html#cb17-4" tabindex="-1"></a><span class="fu">plot</span>(r)</span></code></pre></div>
<p><img src="book_files/figure-html/sst_plot-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>To explore the high temperatures near the UK in more detail, indicators are used to create a smaller array which focusses on the appropriate latitude and longitudes.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="visualising-spatial-data.html#cb18-1" tabindex="-1"></a>ind.lon <span class="ot">&lt;-</span> <span class="fu">which</span>(lon <span class="sc">&gt;</span> <span class="dv">345</span> <span class="sc">&amp;</span> lon <span class="sc">&lt;</span> <span class="dv">360</span>)</span>
<span id="cb18-2"><a href="visualising-spatial-data.html#cb18-2" tabindex="-1"></a>ind.lat <span class="ot">&lt;-</span> <span class="fu">which</span>(lat <span class="sc">&gt;</span>  <span class="dv">48</span> <span class="sc">&amp;</span> lat <span class="sc">&lt;</span>  <span class="dv">60</span>)</span>
<span id="cb18-3"><a href="visualising-spatial-data.html#cb18-3" tabindex="-1"></a>anom_UK <span class="ot">&lt;-</span> anom[ind.lon, ind.lat]</span>
<span id="cb18-4"><a href="visualising-spatial-data.html#cb18-4" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(anom_UK), <span class="at">xmn=</span><span class="fu">min</span>(lon[ind.lon]), <span class="at">xmx=</span><span class="fu">max</span>(lon[ind.lon]),</span>
<span id="cb18-5"><a href="visualising-spatial-data.html#cb18-5" tabindex="-1"></a>            <span class="at">ymn=</span><span class="fu">min</span>(lat[ind.lat]), <span class="at">ymx=</span><span class="fu">max</span>(lat[ind.lat]),</span>
<span id="cb18-6"><a href="visualising-spatial-data.html#cb18-6" tabindex="-1"></a>            <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb18-7"><a href="visualising-spatial-data.html#cb18-7" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">flip</span>(r, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb18-8"><a href="visualising-spatial-data.html#cb18-8" tabindex="-1"></a><span class="fu">plot</span>(r)</span></code></pre></div>
<p><img src="book_files/figure-html/sst_plot_UK-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="spatiotemporal-animation" class="section level3 hasAnchor" number="2.1.8">
<h3><span class="header-section-number">2.1.8</span> Spatiotemporal animation<a href="visualising-spatial-data.html#spatiotemporal-animation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>rpanel</code> package includes an <code>rp.plot4d</code> function which uses animation to provide an extra dimension to displays. The <code>rp.spacetime</code> version of this function is intended particularly for data over space and time.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="visualising-spatial-data.html#cb19-1" tabindex="-1"></a><span class="fu">library</span>(rpanel)</span>
<span id="cb19-2"><a href="visualising-spatial-data.html#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="visualising-spatial-data.html#cb19-3" tabindex="-1"></a>Month     <span class="ot">&lt;-</span> SO2<span class="sc">$</span>month <span class="sc">+</span> (SO2<span class="sc">$</span>year <span class="sc">-</span> <span class="dv">1990</span>) <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb19-4"><a href="visualising-spatial-data.html#cb19-4" tabindex="-1"></a>Year      <span class="ot">&lt;-</span> SO2<span class="sc">$</span>year <span class="sc">+</span> (SO2<span class="sc">$</span>month <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb19-5"><a href="visualising-spatial-data.html#cb19-5" tabindex="-1"></a>location  <span class="ot">&lt;-</span> <span class="fu">cbind</span>(SO2<span class="sc">$</span>longitude, SO2<span class="sc">$</span>latitude)</span>
<span id="cb19-6"><a href="visualising-spatial-data.html#cb19-6" tabindex="-1"></a>mapxy     <span class="ot">&lt;-</span> maps<span class="sc">::</span><span class="fu">map</span>(<span class="st">&#39;world&#39;</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-7"><a href="visualising-spatial-data.html#cb19-7" tabindex="-1"></a>                 <span class="at">xlim =</span> <span class="fu">range</span>(SO2<span class="sc">$</span>longitude), <span class="at">ylim =</span> <span class="fu">range</span>(SO2<span class="sc">$</span>latitude))</span>
<span id="cb19-8"><a href="visualising-spatial-data.html#cb19-8" tabindex="-1"></a>back      <span class="ot">&lt;-</span> <span class="cf">function</span>() maps<span class="sc">::</span><span class="fu">map</span>(mapxy, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-9"><a href="visualising-spatial-data.html#cb19-9" tabindex="-1"></a><span class="fu">rp.spacetime</span>(location, Year, SO2<span class="sc">$</span>logSO2, <span class="at">col.palette =</span> <span class="fu">rev</span>(<span class="fu">heat.colors</span>(<span class="dv">12</span>)),</span>
<span id="cb19-10"><a href="visualising-spatial-data.html#cb19-10" tabindex="-1"></a>              <span class="at">background.plot =</span> back)</span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="models-for-space.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="models-for-point-pattern-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["book.pdf", "book.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
