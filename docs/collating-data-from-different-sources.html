<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.3 Collating data from different sources | Statistical Modelling</title>
  <meta name="description" content="A conceptual, visual and practical introduction to statistical modelling" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="3.3 Collating data from different sources | Statistical Modelling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A conceptual, visual and practical introduction to statistical modelling" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.3 Collating data from different sources | Statistical Modelling" />
  
  <meta name="twitter:description" content="A conceptual, visual and practical introduction to statistical modelling" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dplyr.html"/>
<link rel="next" href="tidy-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/rglWebGL-binding-1.3.17/rglWebGL.js"></script>
<link href="libs/rglwidgetClass-1.3.17/rgl.css" rel="stylesheet" />
<script src="libs/rglwidgetClass-1.3.17/rglClass.min.js"></script>
<script src="libs/CanvasMatrix4-1.3.17/CanvasMatrix.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A visual and conceptual introduction to statistical modelling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface: what’s the problem?</a></li>
<li class="chapter" data-level="" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html"><i class="fa fa-check"></i>Getting started with R</a></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="where-data.html"><a href="where-data.html"><i class="fa fa-check"></i><b>1</b> Where do data come from?</a>
<ul>
<li class="chapter" data-level="1.1" data-path="examples-data.html"><a href="examples-data.html"><i class="fa fa-check"></i><b>1.1</b> Some examples of data</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="examples-data.html"><a href="examples-data.html#co2-and-global-warming"><i class="fa fa-check"></i><b>1.1.1</b> CO2 and global warming</a></li>
<li class="chapter" data-level="1.1.2" data-path="examples-data.html"><a href="examples-data.html#the-first-tuberculosis-trial"><i class="fa fa-check"></i><b>1.1.2</b> The first tuberculosis trial</a></li>
<li class="chapter" data-level="1.1.3" data-path="examples-data.html"><a href="examples-data.html#the-birds-and-the-bees-how-to-tell-the-sex-of-a-herring-gull"><i class="fa fa-check"></i><b>1.1.3</b> The birds and the bees: how to tell the sex of a herring gull</a></li>
<li class="chapter" data-level="1.1.4" data-path="examples-data.html"><a href="examples-data.html#tracking-the-covid-pandemic"><i class="fa fa-check"></i><b>1.1.4</b> Tracking the covid pandemic</a></li>
<li class="chapter" data-level="1.1.5" data-path="examples-data.html"><a href="examples-data.html#more-complex-data-objects"><i class="fa fa-check"></i><b>1.1.5</b> More complex data objects</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="some-broad-issues.html"><a href="some-broad-issues.html"><i class="fa fa-check"></i><b>1.2</b> Some broad issues</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="some-broad-issues.html"><a href="some-broad-issues.html#whats-the-problem"><i class="fa fa-check"></i><b>1.2.1</b> What’s the problem?</a></li>
<li class="chapter" data-level="1.2.2" data-path="some-broad-issues.html"><a href="some-broad-issues.html#whats-the-plan"><i class="fa fa-check"></i><b>1.2.2</b> What’s the plan?</a></li>
<li class="chapter" data-level="1.2.3" data-path="some-broad-issues.html"><a href="some-broad-issues.html#where-data-subsection"><i class="fa fa-check"></i><b>1.2.3</b> Where do the data come from?</a></li>
<li class="chapter" data-level="1.2.4" data-path="some-broad-issues.html"><a href="some-broad-issues.html#who-do-you-trust"><i class="fa fa-check"></i><b>1.2.4</b> Who do you trust?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="what-could-possibly-go-wrong.html"><a href="what-could-possibly-go-wrong.html"><i class="fa fa-check"></i><b>1.3</b> What could possibly go wrong?</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="what-could-possibly-go-wrong.html"><a href="what-could-possibly-go-wrong.html#us-presidential-elections-1936-and-1948"><i class="fa fa-check"></i><b>1.3.1</b> US presidential elections, 1936 and 1948</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="further-reading.html"><a href="further-reading.html"><i class="fa fa-check"></i><b>1.4</b> Further reading</a></li>
<li class="chapter" data-level="1.5" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>1.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="exercises.html"><a href="exercises.html#an-investigation-of-short-term-memory"><i class="fa fa-check"></i><b>1.5.1</b> An investigation of short-term memory</a></li>
<li class="chapter" data-level="1.5.2" data-path="exercises.html"><a href="exercises.html#a-survey-of-dental-health"><i class="fa fa-check"></i><b>1.5.2</b> A survey of dental health</a></li>
<li class="chapter" data-level="1.5.3" data-path="exercises.html"><a href="exercises.html#hearings-aid-and-dementia"><i class="fa fa-check"></i><b>1.5.3</b> Hearings aid and dementia</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="R-introduction.html"><a href="R-introduction.html"><i class="fa fa-check"></i><b>2</b> A gentle introduction to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="r-fuss.html"><a href="r-fuss.html"><i class="fa fa-check"></i><b>2.1</b> R: what’s all the fuss about?</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="r-fuss.html"><a href="r-fuss.html#history"><i class="fa fa-check"></i><b>2.1.1</b> History</a></li>
<li class="chapter" data-level="2.1.2" data-path="r-fuss.html"><a href="r-fuss.html#why-should-i-be-interested"><i class="fa fa-check"></i><b>2.1.2</b> Why should I be interested?</a></li>
<li class="chapter" data-level="2.1.3" data-path="r-fuss.html"><a href="r-fuss.html#whats-the-down-side"><i class="fa fa-check"></i><b>2.1.3</b> What’s the down side?</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="taste-of-r.html"><a href="taste-of-r.html"><i class="fa fa-check"></i><b>2.2</b> A taste of R</a></li>
<li class="chapter" data-level="2.3" data-path="a-summary-of-key-concepts-in-r.html"><a href="a-summary-of-key-concepts-in-r.html"><i class="fa fa-check"></i><b>2.3</b> A summary of key concepts in R</a></li>
<li class="chapter" data-level="2.4" data-path="reading-data.html"><a href="reading-data.html"><i class="fa fa-check"></i><b>2.4</b> Reading data into R</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="reading-data.html"><a href="reading-data.html#accessing-the-data-used-in-this-book"><i class="fa fa-check"></i><b>2.4.1</b> Accessing the data used in this book</a></li>
<li class="chapter" data-level="2.4.2" data-path="reading-data.html"><a href="reading-data.html#functions-for-reading-data"><i class="fa fa-check"></i><b>2.4.2</b> Functions for reading data</a></li>
<li class="chapter" data-level="2.4.3" data-path="reading-data.html"><a href="reading-data.html#reading-data-example"><i class="fa fa-check"></i><b>2.4.3</b> An example: reading an <em>Excel</em> spreadsheet</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="a-further-example-the-scottish-independence-referendum.html"><a href="a-further-example-the-scottish-independence-referendum.html"><i class="fa fa-check"></i><b>2.5</b> A further example: the Scottish independence referendum</a></li>
<li class="chapter" data-level="2.6" data-path="further-reading-1.html"><a href="further-reading-1.html"><i class="fa fa-check"></i><b>2.6</b> Further reading</a></li>
<li class="chapter" data-level="2.7" data-path="exercises-1.html"><a href="exercises-1.html"><i class="fa fa-check"></i><b>2.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="exercises-1.html"><a href="exercises-1.html#scottish-referendum-data"><i class="fa fa-check"></i><b>2.7.1</b> Scottish Referendum data</a></li>
<li class="chapter" data-level="2.7.2" data-path="exercises-1.html"><a href="exercises-1.html#aircraft-designs"><i class="fa fa-check"></i><b>2.7.2</b> Aircraft designs</a></li>
<li class="chapter" data-level="2.7.3" data-path="exercises-1.html"><a href="exercises-1.html#centenarians"><i class="fa fa-check"></i><b>2.7.3</b> Centenarians</a></li>
<li class="chapter" data-level="2.7.4" data-path="exercises-1.html"><a href="exercises-1.html#justification-of-the-log-transformation-for-the-rodent-data"><i class="fa fa-check"></i><b>2.7.4</b> Justification of the log transformation for the rodent data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>3</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="reorganising-data.html"><a href="reorganising-data.html"><i class="fa fa-check"></i><b>3.1</b> Reorganising data</a></li>
<li class="chapter" data-level="3.2" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>3.2</b> Making life easier: the <code>dplyr</code> package</a></li>
<li class="chapter" data-level="3.3" data-path="collating-data-from-different-sources.html"><a href="collating-data-from-different-sources.html"><i class="fa fa-check"></i><b>3.3</b> Collating data from different sources</a></li>
<li class="chapter" data-level="3.4" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>3.4</b> Tidy data</a></li>
<li class="chapter" data-level="3.5" data-path="further-reading-2.html"><a href="further-reading-2.html"><i class="fa fa-check"></i><b>3.5</b> Further reading</a></li>
<li class="chapter" data-level="3.6" data-path="exercises-2.html"><a href="exercises-2.html"><i class="fa fa-check"></i><b>3.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="exercises-2.html"><a href="exercises-2.html#data-wrangling-exercise-UN-demography"><i class="fa fa-check"></i><b>3.6.1</b> UN demography data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="collating-data-from-different-sources" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Collating data from different sources<a href="collating-data-from-different-sources.html#collating-data-from-different-sources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When the data we need are spread across different sources, collation into a single dataset can be rather messy. The tools of the <code>dplyr</code> package are particularly helpful here. This section also makes use of the <code>readxl</code> package to read Excel spreadsheets.</p>
<blockquote>
<hr />
<p><strong>Example: Giving in the Church of England</strong><br />
The <a href="https://www.churchofengland.org">Church of England</a> is a large organisation whose 12,500 parishes, organised into 42 regions called dioceses, cover the whole of England. This gives a good context within which to explore patterns in charitable giving and <span class="citation">Pickering (<a href="#ref-pickering_1985_applecon">1985</a>)</span> examined this using data from the 1980’s. Prosperity (expressed in employment rate) and attachment (the proportion of the population associated with the church) were identified as important covariates associated with the variations in giving per church member across the country. Interestingly, giving per church member went down as attachment increased. Is this relationship still evident?</p>
<p>The <a href="https://www.churchofengland.org/about/data-services">Data Services</a> unit publishes a large amount of information about the composition and activity of the church so this provides an opportunity to examine whether these effects remain. However, the information required is spread across multiple files covering <a href="https://www.churchofengland.org/sites/default/files/2021-12/2020StatisticsForMission_tables.xlsx">attendance</a>, <a href="https://www.churchofengland.org/sites/default/files/2022-01/Parish_Census_IMD2019_Summary_Jan2022.xlsx">deprivation</a> and <a href="https://www.churchofengland.org/sites/default/files/2023-03/parish-finance-statistics-2021_diocesan-totals-.xlsx">giving</a>. You may like to follow these links to look at the form and content of these spreadsheets.</p>
<hr />
</blockquote>
<p>The first task is to collate the information into a single dataset containing the appropriate data. We will focus on 2019 as this is pre-pandemic. The English Index of Multiple Deprivation (IMD) will be used as a measure of regional prosperity. It is appropriate to exclude Europe, the Channel Islands and the Isle of Man, for which some information is not available. These are also regions with unusual characteristics.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="collating-data-from-different-sources.html#cb33-1" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb33-2"><a href="collating-data-from-different-sources.html#cb33-2" tabindex="-1"></a></span>
<span id="cb33-3"><a href="collating-data-from-different-sources.html#cb33-3" tabindex="-1"></a>path.attend <span class="ot">&lt;-</span> <span class="fu">rp.datalink</span>(<span class="st">&#39;cofe_attendance_2019&#39;</span>)</span>
<span id="cb33-4"><a href="collating-data-from-different-sources.html#cb33-4" tabindex="-1"></a>path.giving <span class="ot">&lt;-</span> <span class="fu">rp.datalink</span>(<span class="st">&#39;cofe_giving_2019&#39;</span>)</span>
<span id="cb33-5"><a href="collating-data-from-different-sources.html#cb33-5" tabindex="-1"></a>path.depriv <span class="ot">&lt;-</span> <span class="fu">rp.datalink</span>(<span class="st">&#39;cofe_deprivation_2019&#39;</span>)</span>
<span id="cb33-6"><a href="collating-data-from-different-sources.html#cb33-6" tabindex="-1"></a></span>
<span id="cb33-7"><a href="collating-data-from-different-sources.html#cb33-7" tabindex="-1"></a>d.elect <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(path.attend, <span class="at">sheet =</span> <span class="dv">5</span>, <span class="at">range =</span> <span class="st">&#39;B4:I47&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="collating-data-from-different-sources.html#cb33-8" tabindex="-1"></a>   <span class="fu">select</span>(<span class="at">Diocese =</span> <span class="dv">1</span>, <span class="at">Elect =</span> <span class="dv">3</span>, <span class="at">Worship =</span> <span class="dv">6</span>)</span></code></pre></div>
<p>The instructions above make use of the <code>read_excel</code> function to read an <em>Excel</em> spreadsheet. This includes helpful arguments to specify which sheet and which block of cells we would like to read from. The <code>select</code> function from the <code>dplyr</code> package then allows us to select out three columns of interest while simultaneously renaming them. The <em>pipe</em> operator discussed in the previous section allows these operation to be combined neatly. Notice that <code>dplyr</code> functions create <em>tibbles</em>. These are dataframes with some extra features.</p>
<p>We can apply this idea when reading the spreadsheets about attendance, giving and deprivation. The deprivation information is actually supplied at a finer level (parish) so the <code>group_by</code> and <code>summarise</code> functions allow us to aggregate to the level (diocese) which matches the information from the other spreadsheets.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="collating-data-from-different-sources.html#cb34-1" tabindex="-1"></a>d.attend <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(path.attend, <span class="at">sheet =</span> <span class="dv">6</span>, <span class="at">range =</span> <span class="st">&#39;B4:D47&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="collating-data-from-different-sources.html#cb34-2" tabindex="-1"></a>   <span class="fu">select</span>(<span class="at">Diocese =</span> <span class="dv">1</span>, <span class="at">Attend =</span> <span class="dv">3</span>)</span>
<span id="cb34-3"><a href="collating-data-from-different-sources.html#cb34-3" tabindex="-1"></a>d.giving <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(path.giving, <span class="at">sheet =</span> <span class="dv">3</span>, <span class="at">range =</span> <span class="st">&#39;B8:BS49&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="collating-data-from-different-sources.html#cb34-4" tabindex="-1"></a>   <span class="fu">select</span>(<span class="at">Diocese =</span> <span class="dv">1</span>, <span class="at">Giving =</span> <span class="dv">19</span>, <span class="at">Givers =</span> <span class="dv">59</span>)</span>
<span id="cb34-5"><a href="collating-data-from-different-sources.html#cb34-5" tabindex="-1"></a>d.depriv <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(path.depriv, <span class="at">sheet =</span> <span class="dv">2</span>, <span class="at">range =</span> <span class="st">&#39;A1:AK12408&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="collating-data-from-different-sources.html#cb34-6" tabindex="-1"></a>   <span class="fu">select</span>(<span class="at">Diocese =</span> <span class="dv">11</span>, <span class="at">population =</span> <span class="dv">13</span>, <span class="at">IMD =</span> <span class="dv">37</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="collating-data-from-different-sources.html#cb34-7" tabindex="-1"></a>   <span class="fu">group_by</span>(Diocese) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="collating-data-from-different-sources.html#cb34-8" tabindex="-1"></a>   <span class="fu">summarise</span>(<span class="at">IMD =</span> <span class="fu">sum</span>(IMD <span class="sc">*</span> population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span></span>
<span id="cb34-9"><a href="collating-data-from-different-sources.html#cb34-9" tabindex="-1"></a>                   <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-10"><a href="collating-data-from-different-sources.html#cb34-10" tabindex="-1"></a>             <span class="at">population =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p>Before joining these different sets of information togethjer, it would be wise to check that there are no inconsistencies in the way the information has been coded. The <code>anti_join</code> function is very useful for this. Here is identifies some small differences in the names of the dioceses.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="collating-data-from-different-sources.html#cb35-1" tabindex="-1"></a><span class="fu">anti_join</span>(d.elect,  d.attend, <span class="at">by =</span> <span class="st">&#39;Diocese&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 0 × 3
## # ℹ 3 variables: Diocese &lt;chr&gt;, Elect &lt;dbl&gt;, Worship &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="collating-data-from-different-sources.html#cb37-1" tabindex="-1"></a><span class="fu">anti_join</span>(d.giving, d.attend, <span class="at">by =</span> <span class="st">&#39;Diocese&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   Diocese                    Giving Givers
##   &lt;chr&gt;                       &lt;dbl&gt;  &lt;dbl&gt;
## 1 St.Albans                12579567  15283
## 2 St.Edmundsbury &amp; Ipswich  4614832   8542
## 3 Sodor and Man              447514    623</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="collating-data-from-different-sources.html#cb39-1" tabindex="-1"></a><span class="fu">anti_join</span>(d.depriv, d.attend, <span class="at">by =</span> <span class="st">&#39;Diocese&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   Diocese                    IMD population
##   &lt;chr&gt;                    &lt;dbl&gt;      &lt;dbl&gt;
## 1 St.Albans                 14.7   1927579.
## 2 St.Edmundsbury &amp; Ipswich  17.1    679678.</code></pre>
<p>That can be fixed by using the <code>mutate</code> and <code>recode</code> functions.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="collating-data-from-different-sources.html#cb41-1" tabindex="-1"></a>d.attend <span class="ot">&lt;-</span> <span class="fu">mutate</span>(d.attend, <span class="at">Diocese =</span> <span class="fu">recode</span>(Diocese,</span>
<span id="cb41-2"><a href="collating-data-from-different-sources.html#cb41-2" tabindex="-1"></a>                   <span class="st">&#39;St. Albans&#39;</span> <span class="ot">=</span> <span class="st">&#39;St.Albans&#39;</span>,</span>
<span id="cb41-3"><a href="collating-data-from-different-sources.html#cb41-3" tabindex="-1"></a>                   <span class="st">&#39;St. Edms &amp; Ipswich&#39;</span> <span class="ot">=</span> <span class="st">&#39;St.Edmundsbury &amp; Ipswich&#39;</span>))</span>
<span id="cb41-4"><a href="collating-data-from-different-sources.html#cb41-4" tabindex="-1"></a>d.elect  <span class="ot">&lt;-</span> <span class="fu">mutate</span>(d.elect, <span class="at">Diocese =</span> <span class="fu">recode</span>(Diocese,</span>
<span id="cb41-5"><a href="collating-data-from-different-sources.html#cb41-5" tabindex="-1"></a>                   <span class="st">&#39;St. Albans&#39;</span> <span class="ot">=</span> <span class="st">&#39;St.Albans&#39;</span>,</span>
<span id="cb41-6"><a href="collating-data-from-different-sources.html#cb41-6" tabindex="-1"></a>                   <span class="st">&#39;St. Edms &amp; Ipswich&#39;</span> <span class="ot">=</span> <span class="st">&#39;St.Edmundsbury &amp; Ipswich&#39;</span>))</span>
<span id="cb41-7"><a href="collating-data-from-different-sources.html#cb41-7" tabindex="-1"></a>d.giving <span class="ot">&lt;-</span> <span class="fu">mutate</span>(d.giving, <span class="at">Diocese =</span> <span class="fu">recode</span>(Diocese,</span>
<span id="cb41-8"><a href="collating-data-from-different-sources.html#cb41-8" tabindex="-1"></a>                   <span class="st">&#39;Sodor and Man&#39;</span> <span class="ot">=</span> <span class="st">&#39;Sodor &amp; Man&#39;</span>))</span></code></pre></div>
<p>Now we are in a position to join everything together using the <code>full_join</code> function, with a further adjustment to express attachment on a proportional scale and giving on a ‘per member’ scale.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="collating-data-from-different-sources.html#cb42-1" tabindex="-1"></a>cofe_2019 <span class="ot">&lt;-</span> d.attend <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="collating-data-from-different-sources.html#cb42-2" tabindex="-1"></a>        <span class="fu">full_join</span>(d.elect,  <span class="at">by =</span> <span class="st">&#39;Diocese&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="collating-data-from-different-sources.html#cb42-3" tabindex="-1"></a>        <span class="fu">full_join</span>(d.depriv, <span class="at">by =</span> <span class="st">&#39;Diocese&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="collating-data-from-different-sources.html#cb42-4" tabindex="-1"></a>        <span class="fu">full_join</span>(d.giving, <span class="at">by =</span> <span class="st">&#39;Diocese&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="collating-data-from-different-sources.html#cb42-5" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Attachment =</span> Attend <span class="sc">/</span> population,</span>
<span id="cb42-6"><a href="collating-data-from-different-sources.html#cb42-6" tabindex="-1"></a>               <span class="at">Giving_per_member =</span> Giving <span class="sc">/</span> Elect)</span></code></pre></div>
<p>Now that the data have been collated into a single dataframe, we are ready to produce some plots which will address the question we began with. There is a lot of variation here. We will revisit this example in Chapter <a href="#linear-models"><strong>??</strong></a> when we discuss the topic of linear models.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="collating-data-from-different-sources.html#cb43-1" tabindex="-1"></a><span class="fu">plot</span>(Giving_per_member <span class="sc">~</span> Attachment, <span class="at">data =</span> cofe_2019)</span>
<span id="cb43-2"><a href="collating-data-from-different-sources.html#cb43-2" tabindex="-1"></a><span class="fu">plot</span>(Giving_per_member <span class="sc">~</span> IMD, <span class="at">data =</span> cofe_2019)</span></code></pre></div>
<p><img src="book_files/figure-html/cofe_plots-1.png" width="49%" /><img src="book_files/figure-html/cofe_plots-2.png" width="49%" /></p>
<p>This example further illustrates the power of the tools provided by the <code>dplyr</code> package. These manipulations could be performed through standard R functions but the code is likely to be much longer and more complex.</p>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-pickering_1985_applecon" class="csl-entry">
Pickering, JF. 1985. <span>“Giving in the Church of England: An Econometric Analysis.”</span> <em>Applied Economics</em> 17 (4): 619–32.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dplyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tidy-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["book.pdf", "book.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
