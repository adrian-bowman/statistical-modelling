<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.4 Further examples of mixed models | Statistical Modelling</title>
  <meta name="description" content="A conceptual, visual and practical introduction to statistical modelling" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="1.4 Further examples of mixed models | Statistical Modelling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A conceptual, visual and practical introduction to statistical modelling" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.4 Further examples of mixed models | Statistical Modelling" />
  
  <meta name="twitter:description" content="A conceptual, visual and practical introduction to statistical modelling" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="inference-with-mixed-models.html"/>
<link rel="next" href="non-linear-mixed-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A visual and conceptual introduction to statistical modelling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface: what’s the problem?</a></li>
<li class="chapter" data-level="1" data-path="models-with-random-effects.html"><a href="models-with-random-effects.html"><i class="fa fa-check"></i><b>1</b> Models with random effects</a>
<ul>
<li class="chapter" data-level="1.1" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>1.1</b> Examples</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="examples.html"><a href="examples.html#the-manufacture-of-penicillin"><i class="fa fa-check"></i><b>1.1.1</b> The manufacture of penicillin</a></li>
<li class="chapter" data-level="1.1.2" data-path="examples.html"><a href="examples.html#childhood-growth"><i class="fa fa-check"></i><b>1.1.2</b> Childhood growth</a></li>
<li class="chapter" data-level="1.1.3" data-path="examples.html"><a href="examples.html#the-strength-of-paste"><i class="fa fa-check"></i><b>1.1.3</b> The strength of paste</a></li>
<li class="chapter" data-level="1.1.4" data-path="examples.html"><a href="examples.html#common-features"><i class="fa fa-check"></i><b>1.1.4</b> Common features</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="formulating-and-fitting-mixed-effects-models.html"><a href="formulating-and-fitting-mixed-effects-models.html"><i class="fa fa-check"></i><b>1.2</b> Formulating and fitting mixed effects models</a></li>
<li class="chapter" data-level="1.3" data-path="inference-with-mixed-models.html"><a href="inference-with-mixed-models.html"><i class="fa fa-check"></i><b>1.3</b> Inference with mixed models</a></li>
<li class="chapter" data-level="1.4" data-path="further-examples-of-mixed-models.html"><a href="further-examples-of-mixed-models.html"><i class="fa fa-check"></i><b>1.4</b> Further examples of mixed models</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="further-examples-of-mixed-models.html"><a href="further-examples-of-mixed-models.html#childhood-growth-1"><i class="fa fa-check"></i><b>1.4.1</b> Childhood growth</a></li>
<li class="chapter" data-level="1.4.2" data-path="further-examples-of-mixed-models.html"><a href="further-examples-of-mixed-models.html#the-strength-of-paste-1"><i class="fa fa-check"></i><b>1.4.2</b> The strength of paste</a></li>
<li class="chapter" data-level="1.4.3" data-path="further-examples-of-mixed-models.html"><a href="further-examples-of-mixed-models.html#the-sleep-deprivation-study"><i class="fa fa-check"></i><b>1.4.3</b> The sleep deprivation study</a></li>
<li class="chapter" data-level="1.4.4" data-path="further-examples-of-mixed-models.html"><a href="further-examples-of-mixed-models.html#reading-attainment-in-primary-school"><i class="fa fa-check"></i><b>1.4.4</b> Reading attainment in primary school</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="non-linear-mixed-models.html"><a href="non-linear-mixed-models.html"><i class="fa fa-check"></i><b>1.5</b> Non-linear mixed models</a></li>
<li class="chapter" data-level="1.6" data-path="generalised-linear-mixed-models.html"><a href="generalised-linear-mixed-models.html"><i class="fa fa-check"></i><b>1.6</b> Generalised linear mixed models</a></li>
<li class="chapter" data-level="1.7" data-path="further-reading.html"><a href="further-reading.html"><i class="fa fa-check"></i><b>1.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="further-examples-of-mixed-models" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Further examples of mixed models<a href="further-examples-of-mixed-models.html#further-examples-of-mixed-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="childhood-growth-1" class="section level3 hasAnchor" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Childhood growth<a href="further-examples-of-mixed-models.html#childhood-growth-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An initial model can be written as
<span class="math display">\[
      y_{ijk} = \alpha + \beta x_{ij} + \gamma_k + \varepsilon_{ij} ,
\]</span>
where <span class="math inline">\(y_{ijk}\)</span> denotes the <span class="math inline">\(j\)</span>th measurement for subject <span class="math inline">\(i\)</span>, with the sex groups identified through the subscript <span class="math inline">\(k\)</span>. In addition to the regression effect on <span class="math inline">\(x\)</span>, the <span class="math inline">\(\gamma_k\)</span> capture the mean adjustment due to sex. The plot below superimposes the fitted model on the data. As expected, this model is too simple as it does not capture the variation across subjects. Some lie consistently above the regression line and other consistently below.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="further-examples-of-mixed-models.html#cb23-1" tabindex="-1"></a>ortho_model_0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex, <span class="at">data =</span> Orthodont)</span>
<span id="cb23-2"><a href="further-examples-of-mixed-models.html#cb23-2" tabindex="-1"></a><span class="fu">ggplot</span>(Orthodont, <span class="fu">aes</span>(age, distance, <span class="at">col =</span> Sex)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-3"><a href="further-examples-of-mixed-models.html#cb23-3" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fitted</span>(ortho_model_0))) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span></code></pre></div>
<p><img src="book_files/figure-html/ortho_fit_0-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This can be addressed by introducing a random effect which allows an adjustment to the intercept for each subject:</p>
<p><span class="math display">\[
      y_{ij} = (\alpha + a_i) + \beta x_{ij} + \varepsilon_{ij}.
\]</span>
where <span class="math inline">\(a_i \sim N(0, \sigma^2_a)\)</span>. The plot below shows this to be a much better description of the data. The estimates of the parameters, with their standard errors, suggest that there is indeed a small sex effect, with a t-value around <span class="math inline">\(3\)</span>. We can also quantify the subject variation, which is estaimted to be larger than the residual variation.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="further-examples-of-mixed-models.html#cb24-1" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb24-2"><a href="further-examples-of-mixed-models.html#cb24-2" tabindex="-1"></a>ortho_model_1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Subject), <span class="at">data =</span> Orthodont)</span>
<span id="cb24-3"><a href="further-examples-of-mixed-models.html#cb24-3" tabindex="-1"></a><span class="fu">ggplot</span>(Orthodont, <span class="fu">aes</span>(age, distance, <span class="at">col =</span> Sex)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-4"><a href="further-examples-of-mixed-models.html#cb24-4" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fitted</span>(ortho_model_1))) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span>
<span id="cb24-5"><a href="further-examples-of-mixed-models.html#cb24-5" tabindex="-1"></a><span class="fu">summary</span>(ortho_model_1)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##               Estimate Std. Error   t value
## (Intercept) 17.7067130 0.83392247 21.233044
## age          0.6601852 0.06160592 10.716263
## SexFemale   -2.3210227 0.76141685 -3.048294</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="further-examples-of-mixed-models.html#cb26-1" tabindex="-1"></a><span class="fu">summary</span>(ortho_model_1)<span class="sc">$</span>varcor</span></code></pre></div>
<pre><code>##  Groups   Name        Std.Dev.
##  Subject  (Intercept) 1.8074  
##  Residual             1.4316</code></pre>
<p><img src="book_files/figure-html/ortho_fit_1-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We should also pay attention to whether the fixed effects may be more complex. In particular, is there interaction between age and sex? The analysis below does indicate eome evidence for this.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="further-examples-of-mixed-models.html#cb28-1" tabindex="-1"></a>ortho_model_2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(distance <span class="sc">~</span> age <span class="sc">*</span> Sex <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Subject), <span class="at">data =</span> Orthodont)</span>
<span id="cb28-2"><a href="further-examples-of-mixed-models.html#cb28-2" tabindex="-1"></a><span class="fu">ggplot</span>(Orthodont, <span class="fu">aes</span>(age, distance, <span class="at">col =</span> Sex)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-3"><a href="further-examples-of-mixed-models.html#cb28-3" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fitted</span>(ortho_model_2))) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span>
<span id="cb28-4"><a href="further-examples-of-mixed-models.html#cb28-4" tabindex="-1"></a><span class="fu">summary</span>(ortho_model_2)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##                 Estimate Std. Error    t value
## (Intercept)   16.3406250  0.9813122 16.6518101
## age            0.7843750  0.0775011 10.1208235
## SexFemale      1.0321023  1.5374208  0.6713206
## age:SexFemale -0.3048295  0.1214209 -2.5105197</code></pre>
<p><img src="book_files/figure-html/unnamed-chunk-40-1.png" width="70%" style="display: block; margin: auto;" /></p>
<!-- Intercept and slope random effects -->
<!-- Allow a different intercept and slope to each group of data. -->
<!-- $$ -->
<!--       y_{ij} = (\alpha + a_i) +  (\beta + b_i) x_{ij} + \varepsilon_{ij}. -->
<!-- $$ -->
<!-- where -->
<!-- $$ -->
<!-- a_i \sim N(0, \sigma^2_a), \hspace{3em} -->
<!-- b_i \sim N(0, \sigma^2_b), \hspace{3em} -->
<!-- $$ -->
<!-- ```{r ortho_fit_2} -->
<!-- ortho_model_2 <- lmer(distance ~ age + Sex + (age | Subject), data = Orthodont) -->
<!-- ggplot(Orthodont, aes(age, distance)) + geom_point() + -->
<!--    geom_line(aes(y = fitted(ortho_model_2))) + facet_wrap(~ Subject) -->
<!-- ``` -->
<!-- Comparing models -->
<!-- ```{r} -->
<!-- anova(ortho_model_2, ortho_model_1) -->
<!-- ``` -->
<!-- ```{r warning = FALSE, cache = TRUE} -->
<!-- library(pbkrtest) -->
<!-- PBmodcomp(ortho_model_2, ortho_model_1) -->
<!-- ``` -->
<!-- Final model -->
<!-- ```{r} -->
<!-- summary(ortho_model_2)$coefficients -->
<!-- summary(ortho_model_2)$varcor -->
<!-- ``` -->
<!-- ```{r warning = FALSE} -->
<!-- library(lmerTest) -->
<!-- ortho_model_2 <- lmer(distance ~ age + (age | Subject), data = Orthodont) -->
<!-- summary(ortho_model_2)$coefficients -->
<!-- summary(ortho_model_2)$varcor -->
<!-- confint(ortho_model_2) -->
<!-- ``` -->
</div>
<div id="the-strength-of-paste-1" class="section level3 hasAnchor" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> The strength of paste<a href="further-examples-of-mixed-models.html#the-strength-of-paste-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A <em>mixed effects</em> model allows different (hierarchical) levels of error to be constructed. Each batch has its own ‘adjustment’ from the overall mean. Within each batch, each cask has its own further ‘adjustment’ from the overall and batch means. Within each cask, the individual within-cask measurements can be viewed as further ‘adjustments’ from the overall, batch and cask means. If we index the batches, casks and within-cask measurements by <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span> and <span class="math inline">\(w\)</span>, then we can express this in a model as:
<span class="math display">\[
      y_{bcw} = \mu + \varepsilon_b + \varepsilon_{bc} + \varepsilon_{bcw}
\]</span>
where
<span class="math display">\[
\varepsilon_{b} \sim N(0, \sigma^2_b), \hspace{3em}
\varepsilon_{bc} \sim N(0, \sigma^2_c), \hspace{3em}
\varepsilon_{bcw} \sim N(0, \sigma^2_w)
\]</span></p>
<p>The <code>lme4</code> package gives us the tools to fit such a model. The estimates of standard deviation at batch, cask, and within-cask levels suggests that the cask level is where the variation is strongest. Another look at the plot shown earlier in this chapter does suggest that this is indeed the case.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="further-examples-of-mixed-models.html#cb30-1" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb30-2"><a href="further-examples-of-mixed-models.html#cb30-2" tabindex="-1"></a>pastes_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(strength <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>batch<span class="sc">/</span>cask), <span class="at">data =</span> Pastes)</span>
<span id="cb30-3"><a href="further-examples-of-mixed-models.html#cb30-3" tabindex="-1"></a><span class="fu">summary</span>(pastes_model)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##             Estimate Std. Error  t value
## (Intercept) 60.05333  0.6768702 88.72208</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="further-examples-of-mixed-models.html#cb32-1" tabindex="-1"></a><span class="fu">summary</span>(pastes_model)<span class="sc">$</span>varcor</span></code></pre></div>
<pre><code>##  Groups     Name        Std.Dev.
##  cask:batch (Intercept) 2.90408 
##  batch      (Intercept) 1.28737 
##  Residual               0.82341</code></pre>
<p>When using any model, we would like to have some reassurance that it describes the data adequately. Plot of residuals provide an informal, but very useful, way of checking this. If the model is adequate then the residuals should simply display random variation, with no obvious patterns or structure. The plot below reassures us that the model is an adequate fit.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="further-examples-of-mixed-models.html#cb34-1" tabindex="-1"></a><span class="fu">plot</span>(pastes_model)</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-42-1.png" width="49%" style="display: block; margin: auto;" /></p>
</div>
<div id="the-sleep-deprivation-study" class="section level3 hasAnchor" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> The sleep deprivation study<a href="further-examples-of-mixed-models.html#the-sleep-deprivation-study" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<hr />
<blockquote>
<p><strong>Example: The sleep deprivation study</strong></p>
<p><span class="citation">Belenky et al. (<a href="#ref-belenky_2003_jsleepres">2003</a>)</span> describe an experiment where the reaction times of subjects were recorded after different numbers of days of sleep deprivation. How should we model the relationship between reaction time and sleep deprivation while properly including a description of the sources of variation?</p>
<p>A subset of the data reported by <span class="citation">Belenky et al. (<a href="#ref-belenky_2003_jsleepres">2003</a>)</span> is available in the <code>sleepstudy</code> dataframe of the <code>lme4</code> package.</p>
</blockquote>
<hr />
<p>Initial plots shows an upward trend in mean reaction time as the number of days os sleep deprivation increases. That is entirely expected. There is also considerable variability across subjects.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="further-examples-of-mixed-models.html#cb35-1" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb35-2"><a href="further-examples-of-mixed-models.html#cb35-2" tabindex="-1"></a><span class="fu">str</span>(sleepstudy)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    180 obs. of  3 variables:
##  $ Reaction: num  250 259 251 321 357 ...
##  $ Days    : num  0 1 2 3 4 5 6 7 8 9 ...
##  $ Subject : Factor w/ 18 levels &quot;308&quot;,&quot;309&quot;,&quot;310&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="further-examples-of-mixed-models.html#cb37-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb37-2"><a href="further-examples-of-mixed-models.html#cb37-2" tabindex="-1"></a><span class="fu">ggplot</span>(sleepstudy, <span class="fu">aes</span>(Days, Reaction, <span class="at">col =</span> Subject)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span>
<span id="cb37-3"><a href="further-examples-of-mixed-models.html#cb37-3" tabindex="-1"></a><span class="fu">ggplot</span>(sleepstudy, <span class="fu">aes</span>(Days, Reaction)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-4"><a href="further-examples-of-mixed-models.html#cb37-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span></code></pre></div>
<p><img src="book_files/figure-html/sleep_structure-1.png" width="49%" /><img src="book_files/figure-html/sleep_structure-2.png" width="49%" /></p>
<p>A model which includes a fixed effect for <code>Days</code> and a random effect for <code>Subject</code> is a natural starting point. The fitted values for this model do not track the data very effectively, with some subjects showing a stronger regreession slope and others a weaker one.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="further-examples-of-mixed-models.html#cb38-1" tabindex="-1"></a>sleep_model_1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> Days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Subject), <span class="at">data =</span> sleepstudy)</span>
<span id="cb38-2"><a href="further-examples-of-mixed-models.html#cb38-2" tabindex="-1"></a><span class="fu">ggplot</span>(sleepstudy, <span class="fu">aes</span>(Days, Reaction)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-3"><a href="further-examples-of-mixed-models.html#cb38-3" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fitted</span>(sleep_model_1))) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span></code></pre></div>
<p><img src="book_files/figure-html/sleep_fit_1-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This suggests that we might do better with a model which allow random variations in both intercept and slope for each subject. The plot below suggests this to be a much better fit.</p>
<p><span class="math display">\[
      y_{ij} = (\alpha + a_i) +  (\beta + b_i) x_{ij} + \varepsilon_{ij}.
\]</span>
where
<span class="math display">\[
a_i \sim N(0, \sigma^2_a), \hspace{3em}
b_i \sim N(0, \sigma^2_b), \hspace{3em}
\]</span></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="further-examples-of-mixed-models.html#cb39-1" tabindex="-1"></a>sleep_model_2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> Days <span class="sc">+</span> (Days <span class="sc">|</span> Subject), <span class="at">data =</span> sleepstudy)</span>
<span id="cb39-2"><a href="further-examples-of-mixed-models.html#cb39-2" tabindex="-1"></a><span class="fu">ggplot</span>(sleepstudy, <span class="fu">aes</span>(Days, Reaction)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb39-3"><a href="further-examples-of-mixed-models.html#cb39-3" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fitted</span>(sleep_model_2))) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span></code></pre></div>
<p><img src="book_files/figure-html/sleep_fit_2-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The evidence for the superiority of the model with this form of random effects can be evaluated in a more formal model comparison.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="further-examples-of-mixed-models.html#cb40-1" tabindex="-1"></a><span class="fu">library</span>(pbkrtest)</span>
<span id="cb40-2"><a href="further-examples-of-mixed-models.html#cb40-2" tabindex="-1"></a><span class="fu">PBmodcomp</span>(sleep_model_2, sleep_model_1)</span></code></pre></div>
<pre><code>## Bootstrap test; time: 11.95 sec; samples: 1000; extremes: 0;
## large : Reaction ~ Days + (Days | Subject)
## Reaction ~ Days + (1 | Subject)
##          stat df   p.value    
## LRT    42.139  2 7.072e-10 ***
## PBtest 42.139     0.000999 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<!-- ```{r} -->
<!-- summary(sleep_model_2)$coefficients -->
<!-- summary(sleep_model_2)$varcor -->
<!-- ``` -->
<!-- ```{r} -->
<!-- library(lmerTest) -->
<!-- sleep_model_2 <- lmer(Reaction ~ Days + (Days | Subject), data = sleepstudy) -->
<!-- summary(sleep_model_2)$coefficients -->
<!-- summary(sleep_model_2)$varcor -->
<!-- confint(sleep_model_2) -->
<!-- ``` -->
</div>
<div id="reading-attainment-in-primary-school" class="section level3 hasAnchor" number="1.4.4">
<h3><span class="header-section-number">1.4.4</span> Reading attainment in primary school<a href="further-examples-of-mixed-models.html#reading-attainment-in-primary-school" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<hr />
<blockquote>
<p><strong>Example: Reading attainment in primary school-children</strong></p>
<p>These data arose from a longitudinal study of a cohort of 407 pupils who entered 33 multi-ethnic inner London infant schools in 1982, and who were followed-up until the end of their junior schooling in 1989. The reading ability of pupils was tested on up to six occasions: annually from 1982 to 1986 and in 1989. Data are also available on the age of the pupils at the occasions when testing was performed and also their sex and ethnic group. The pupils took a variable number of the assessments and so the data are unbalanced. (Data source: <em>Statistics in Education</em> by Ian Plewis.)</p>
<p>The data set has eight columns:</p>
<ol style="list-style-type: decimal">
<li>School Number (1 to 33)</li>
<li>Pupil Number (1 to 751)</li>
<li>Assessment Occasion (1 to 6)</li>
<li>Reading attainment score</li>
<li>A standardised reading score (to be ignored here)</li>
<li>Ethnic Group (white or black {African Caribbean})</li>
<li>Sex (boy or girl)</li>
<li>Age (in years, but mean-centred)</li>
</ol>
<p>The questions of interest are:</p>
<ul>
<li>How does reading ability develop as children grow older?</li>
<li>Does this development vary from pupil to pupil or from school to school?</li>
<li>If so, does it vary systematically from one type of pupil to another (e.g. boys vs girls, white vs black or both), and according to the characteristics of the school?</li>
</ul>
</blockquote>
<hr />
<p>First we read the data.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="further-examples-of-mixed-models.html#cb42-1" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">rp.datalink</span>(<span class="st">&quot;reading&quot;</span>)</span>
<span id="cb42-2"><a href="further-examples-of-mixed-models.html#cb42-2" tabindex="-1"></a>d    <span class="ot">&lt;-</span> <span class="fu">read.table</span>(path, <span class="at">header =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><code>ggplot</code> graphics again provides a simple way of producing some attractive and helpful visualisations.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="further-examples-of-mixed-models.html#cb43-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb43-2"><a href="further-examples-of-mixed-models.html#cb43-2" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(Age, Readatt)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb43-3"><a href="further-examples-of-mixed-models.html#cb43-3" tabindex="-1"></a>   <span class="fu">facet_grid</span>(Ethnicity <span class="sc">~</span> Sex)</span>
<span id="cb43-4"><a href="further-examples-of-mixed-models.html#cb43-4" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(Age, Readatt, <span class="at">col =</span> Sex)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb43-5"><a href="further-examples-of-mixed-models.html#cb43-5" tabindex="-1"></a>   <span class="fu">facet_wrap</span>(<span class="sc">~</span> School)</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-55-1.png" width="49%" /><img src="book_files/figure-html/unnamed-chunk-55-2.png" width="49%" /></p>
<p>We need to think carefully about how the variability should be modelled. For the moment, we will include only <code>Age</code> in the fixed effects, as this is the variable which clearly influences reading ability strongly. A random effect for each pupil, which allows them to display greater or lesser individual ability, is a good starting point. A residual plot helps us to assess the adequacy of this model, in an informal manner. Some non-random patterns suggest that we need to improve the model.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="further-examples-of-mixed-models.html#cb44-1" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb44-2"><a href="further-examples-of-mixed-models.html#cb44-2" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Readatt <span class="sc">~</span> Age <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> School<span class="sc">/</span>Pupil), <span class="at">data =</span> d)</span>
<span id="cb44-3"><a href="further-examples-of-mixed-models.html#cb44-3" tabindex="-1"></a><span class="fu">plot</span>(model1)</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-56-1.png" width="49%" style="display: block; margin: auto;" /></p>
<p>Another plot may help. This one shsows the trajectory of each individual over time. An interesting feature is a suggestion that these trajectories ‘fan out’ a little over time. This may suggest that pupils who are good readers at an early stage improve their reading ability over time at a greater rate than those who are poorer readers. This sounds plausible.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="further-examples-of-mixed-models.html#cb45-1" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(Age, Readatt, <span class="at">group =</span> Pupil)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb45-2"><a href="further-examples-of-mixed-models.html#cb45-2" tabindex="-1"></a>   <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(School))</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-57-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We can incorporate this into a model by describing these trajectories through straight lines (plus random error) whose slopes are described by random effects. The <code>lme</code> syntax enables this to be specified easily. The residual plot nolonger shows non-random features and a formal test confirms that the simple random effects model is inadequate, in comparison with the model which allows random slopes.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="further-examples-of-mixed-models.html#cb46-1" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Readatt <span class="sc">~</span> Age <span class="sc">+</span> (Age <span class="sc">|</span> School<span class="sc">/</span>Pupil), <span class="at">data =</span> d)</span>
<span id="cb46-2"><a href="further-examples-of-mixed-models.html#cb46-2" tabindex="-1"></a><span class="fu">plot</span>(model2)</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-58-1.png" width="49%" style="display: block; margin: auto;" /></p>
<p>The residual plot has improved. We might also confirm the suitability of the random slopes model by performing a more formal model comparison.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="further-examples-of-mixed-models.html#cb47-1" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span></code></pre></div>
<pre><code>## refitting model(s) with ML (instead of REML)</code></pre>
<pre><code>## Data: d
## Models:
## model1: Readatt ~ Age + (1 | School/Pupil)
## model2: Readatt ~ Age + (Age | School/Pupil)
##        npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    
## model1    5 3793.3 3820.6 -1891.6   3783.3                         
## model2    9 3202.7 3252.0 -1592.4   3184.7 598.57  4  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Now that our model has a good random effects structure, we can examine the fixed effects in greater detail. The summary gives no evidence of an ethnicity effect, but does show a sex effect with girls producing a better average performance, in addition to the age effect which we already know is present.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="further-examples-of-mixed-models.html#cb50-1" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Readatt <span class="sc">~</span> Age <span class="sc">+</span> Sex <span class="sc">+</span> Ethnicity <span class="sc">+</span> (Age <span class="sc">|</span> School<span class="sc">/</span>Pupil),</span>
<span id="cb50-2"><a href="further-examples-of-mixed-models.html#cb50-2" tabindex="-1"></a>               <span class="at">data =</span> d)</span>
<span id="cb50-3"><a href="further-examples-of-mixed-models.html#cb50-3" tabindex="-1"></a><span class="fu">summary</span>(model3)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##                   Estimate Std. Error   t value
## (Intercept)     7.11786474 0.08078526 88.108455
## Age             0.99302519 0.01567750 63.340790
## Sexgirl         0.13267761 0.06133111  2.163300
## Ethnicitywhite -0.09410636 0.06497236 -1.448406</code></pre>
<p>It would be wise for us to examine whether interactions might be present. That is left as an exercise.</p>
<p>As a further exercise, check what conclusions are reached if the random effects structure is simply ignored.</p>
<!-- ## Repeated measurements -->
<!-- ```{r child = 'chapters/random_effects/clyde_stations.Rmd'} -->
<!-- ``` -->
<!-- ```{r child = 'chapters/random_effects/luthor.Rmd'} -->
<!-- ``` -->
<!-- ## Case studies of mixed models -->
<!-- See datasets in the `mlmRev' package. -->
<!-- Use chemistry data there instead of the reading attainment data? -->
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-belenky_2003_jsleepres" class="csl-entry">
Belenky, Gregory, Nancy J Wesensten, David R Thorne, Maria L Thomas, Helen C Sing, Daniel P Redmond, Michael B Russo, and Thomas J Balkin. 2003. <span>“Patterns of Performance Degradation and Restoration During Sleep Restriction and Subsequent Recovery: A Sleep Dose-Response Study.”</span> <em>Journal of Sleep Research</em> 12 (1): 1–12.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="inference-with-mixed-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="non-linear-mixed-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["book.pdf", "book.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
